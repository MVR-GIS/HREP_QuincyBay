---
title: "Rock Island District HREP Water Quality Monitoring sd"
output: 
  flexdashboard::flex_dashboard:
    theme:
      primary: "#9FBCC8"
      base_font:
        google: Prompt
      code_font:
        google: JetBrains Mono
    orientation: columns
    vertical_layout: fill
    logo: "Picture1.png"

---

```{r}
library(flexdashboard)
library(tidyverse)
library(shiny)
library(crosstalk)


```




Column {sd-width=550}
-----------------------------------------------------------------------

### Continuous Monitoring sd

```{r}

  library(anytime)
  library(ggplot.multistats)
  library(ggplot2)
  library(gridExtra)
  library(scales)
  library(plotly)
  library(readr)
  library(tidyr)

#Import and rename continuous sd frame
sd <- read.csv("Compiled Project Spreadsheet.csv", check.names=FALSE)

#Change Date/Time Format

sd <- sd |>
    mutate(DateTime = paste(Date, Time))
  
sd$DateTime <- anytime(sd$DateTime)
  
#Select parameters of use
sd <- sd %>% 
    select("Project", "Site", "Season", "DateTime", "Temp", "SpCon", "DO", "pH", "Turbidity", "Depth")
  
#Pivot sd table
# sd <- sd %>% 
#     pivot_longer(cols = -DateTime, names_to = 'Parameter', values_to = 'Value' )

# Wrap sd in Sharedsd to use with crosstalk
sd <- SharedData$new(sd)  
    
#Plot sd
Temp <- sd |> 
  plot_ly(x=~DateTime, y=~Temp)|> 
  add_lines()

SpCon <- sd |> 
  plot_ly(x=~DateTime, y=~SpCon)|> 
  add_lines()

DO <- sd |> 
  plot_ly(x=~DateTime, y=~DO)|> 
  add_lines()


pH <- sd |> 
  plot_ly(x=~DateTime, y=~pH) |> 
  add_lines()


#Stack plots
crosstalk::bscols(
     list(
       DO,
      Temp,
      pH,
      SpCon
      )
)




  #Interactive Graph
#  ggplotly(Graphs)

```

Column {sd-width=450}
-----------------------------------------------------------------------
    
### Site Locations

```{r}

 library(leaflet)
  library(sp)
  
  #Loc <- read.csv("QuincyBay_Locations.csv")
  
  #Loc$Long <- as.numeric(Loc$Long)
  #Loc$Lat <- as.numeric(Loc$Lat)
  
  
  m <- leaflet() %>% 
    addTiles() %>% 
    addCircleMarkers(lng = -91.41439, lat = 39.97359, label = "W-M329.5Y") %>%
    addCircleMarkers(lng = -91.434937, lat = 39.953843, label = "W-M328.8K") %>% 
    addCircleMarkers(lng = -91.433622, lat = 39.969817, label = "W-M329.8P")
  
  m

```

### Boxplot Statistics

```{r}

# #Import and rename continuous sd frame
# sd <- read.csv("Compiled Project Spreadsheet.csv", check.names=FALSE)
# 
#   
# #Change Date/Time Format
# sd <- sd |>
#   mutate(DateTime = paste(Date, Time))
# 
# sd$DateTime <- anytime(sd$DateTime)
# 
# 
# # Wrap sd in Sharedsd to use with crosstalk
# sd <- SharedData$new(sd)
#   
# #Select parameters of use
# sd <- sd %>% 
#     select(DateTime, "Temp", "DO", "pH", "Turbidity")
#   
# #Pivot sd table
# sd <- sd %>% 
#   pivot_longer(cols = -DateTime, names_to = 'Parameter', values_to = 'Value' )
#   
# #Plot sd
# Graph_box <- ggplot(sd,aes(y=Value, x=factor(0)))+
#   geom_sd()+
#   facet_wrap(vars(Parameter), ncol = 4, scales = "free_y", labeller = labeller(Parameter = 
#                                                                                    c("DO" = "DO (mg/L)",
#                                                                                      "pH" = "pH (none)",
#                                                                                      "Temp" = "Temp (C)",
#                                                                                      "Turbidity" = "Turbidity (FNU)")))+
#     theme_light()+
#     theme(axis.text.x=element_blank())+
#     labs(y= "", x= "")
#   
#   #Interactive Graph
#   ggplotly(Graph_box)

```


Inputs {.sidebar}
-----------------------------------

```{r}


project_filter <- filter_select(
  id = "Prj",
  label = "Project:",
  sharedData = sd,
  group = ~Project
)

site_filter <- filter_select(
  id = "Site",
  label = "Site:",
  sharedData = sd,
  group = ~Site
)

season_filter <- filter_select(
  id = "Season",
  label = "Season:",
  sharedData = sd,
  group = ~Season
)


crosstalk::bscols(
     list(
      project_filter,
      site_filter,
      season_filter)
)



```